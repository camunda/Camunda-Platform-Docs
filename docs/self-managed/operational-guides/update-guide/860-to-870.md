---
id: 860-to-870
title: Update 8.6 to 8.7
description: "Review which adjustments must be made to migrate from Camunda 8.6.x to Camunda 8.7.0."
---

The following sections explain which adjustments must be made to migrate from Camunda 8.6.x to 8.7.x for each component.

## Backup

### Google Cloud Storage

Configuring a non-existing bucket for backups will not prevent Zeebe to start up anymore and will only result
in logs (at WARN) in the startup phase.

## Exported records

### `USER_TASK` records

To support User Task Listeners, some backward incompatible changes were necessary to the exported `USER_TASK` records.

#### `assignee` no longer provided in `CREATING/CREATED` events

Previously, when a user task was activating with a specified `assignee`,
we appended the following events of the `USER_TASK` value type:

- `CREATING` with `assignee` property as provided
- `CREATED` with `assignee` property as provided

The `ASSIGNING` and `ASSIGNED` events were not appended in this case.

To support the new User Task Listeners feature, the `assignee` value will not be filled in the `CREATING` and `CREATED` events anymore.

With 8.7, the following events are now appended:

- `CREATING` with `assignee` always `""` (empty string)
- `CREATED` with `assignee` always `""` (empty string)
- `ASSIGNING` with `assignee` property as provided
- `ASSIGNED` with `assignee` property as provided

#### `ASSIGNING` has become `CLAIMING` for `CLAIM` operation

When claiming a user task, we previously appended the following records of the `USER_TASK` value type:

- `CLAIM`
- `ASSIGNING`
- `ASSIGNED`

A new `CLAIMING` intent was introduced to distinguish between claiming and regular assigning.
We now append the following records when claiming a user task:

- `CLAIM`
- `CLAIMING`
- `ASSIGNED`

The `ASSIGNING` event is still appended for assigning a user task.
In that case, we append the following records:

- `ASSIGN`
- `ASSIGNING`
- `ASSIGNED`

## Prefix migration

:::warning
It is a requirement that Operate and Tasklist (for example, using `camunda.operate.elasticsearch.indexPrefix`) have
custom prefixes defined and that you are migrated to another prefix.
:::

### Make the Elasticsearch instance reachable

The migration relies on communicating directly with Elasticsearch.

The below example relies on a kubernetes environment but any approach works as long as the Elasticsearch instance is reachable
on `http://localhost:9200`.

- **Kubernetes**: Port-forward your Elasticsearch instance to ensure it is reachable. In the following example, `camunda-platform` can be replaced by the service name:

  ```shell
  kubectl port-forward svc/camunda-platform-elasticsearch 9200:9200
  ```

### Create harmonized indices

To begin creating the harmonized indices for migration, first pull the following Docker image:

```shell
docker pull camunda/zeebe:SNAPSHOT
```

Then run the command below, replacing `CAMUNDA_DATABASE_PREFIX` value with your desired prefix, this is necessary as it will
create the harmonised indices so that documents can be re-indexed in the migration.

```shell
docker run --rm -it --env CAMUNDA_DATABASE_URL="host.docker.internal:9200" --env CAMUNDA_DATABASE_INDEXPREFIX=<prefix> --entrypoint /usr/local/zeebe/bin/schema camunda/zeebe:SNAPSHOT
```

### Migrating indices

:::warning
Disk usage will massively increase while the migration is ongoing.
Make sure you have at least double of disk space free.
:::

The migration of the indices assumes that elasticsearch is reachable on
localhost:9200.

#### Migrating to harmonised indices

Given the harmonised indices have been created they can now be re-indexed into. For each index you send an explicit re-index
request, for an example `event` index where the operate prefix is `operate-prefix` and the new desired prefix is `a-prefix`
the following request would be sent.

```shell
curl -x post "http://localhost:9200/_reindex" -h 'content-type: application/json' -d '{
  "source": {
    "index": "operate-prefix-event-8.3.0_"
  },
  "dest": {
    "index": "a-prefix-operate-event-8.3.0_"
  }
}'
```

#### Migrating historic indices

The historic indices must all be migrated, with these indices since the mappings will not change a clone can be utilised.
Given a defined operate prefix of `operate-prefix` for an `event` index, for example `operate-prefix-event-8.3.0_2025-01-01`,
and a new prefix of `a-prefix`, the following requests would be executed to clone the index.

First the index must be made readonly.

```shell
curl -X PUT "http://localhost:9200/operate-prefix-event-8.3.0_2025-01-01/_settings" -H "Content-Type: application/json" -d '{
  "settings": {
    "index.blocks.write": "true"
  }
}'
```

Then after execute the clone.

```shell
curl -x post "http://localhost:9200/operate-prefix-event-8.3.0_2025-01-01/_clone/a-prefix-operate-event-8.3.0_2025-01-01" \
-h 'content-type: application/json' -d '{
  "settings": {
    "index.blocks.write": "false",
    "number_of_replicas": 0
  },
  "aliases": {
    "a-prefix-operate-event-8.3.0_alias": {}"
  }
}'
```

For a better user experience we provide a bash script: `.migrate.sh` to run the migration. The bash script which has dependencies on `jq` and `curl`.
It is required that the: operate, tasklist and new prefix are defined.

:::note
It is recommended that you first back up the Elasticsearch, and test the `migrate.sh` script in a test environment first
to ensure there are no unexpected issues.
:::

```shell
Usage: ./migrate.sh [options]

Options:
  --operate <value>     Prefix defined for operate
  --tasklist <value>    Prefix defined for tasklist
  --prefix <value>      New prefix for harmonised indices
  -h, --help            Display this help message.
```

If you would like to run the migration on your own, refer to the `Migrating to harmonised indices` and `Migrating historic indices`
sections.

### Update to 8.7

With the Elasticsearch migration finished, There are mandatory configuration changes to be made prior to updating to 8.7.

:::note
Without these configuration changes the update to 8.7 will fail.
:::

Given a new desired prefix of `some-prefix`

- The configured `CAMUNDA_OPERATE_ELASTICSEARCH_INDEX_PREFIX` must now be `some-prefix`.
- The configured `CAMUNDA_TASKLIST_ELASTICSEARCH_INDEX_PREFIX` must now be `some-prefix`.
- The prefix for the [Camunda exporter](/self-managed/zeebe-deployment/exporters/camunda-exporter.md) should be configured using `ZEEBE_BROKER_EXPORTERS_CAMUNDA_ARGS_INDEX_PREFIX` to `some-prefix`.
